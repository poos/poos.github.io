I"ÅE<p><strong><a href="https://github.com/poos/BlogDemo">æœ¬æ–‡æ‰€æœ‰ä»£ç  Demo åœ°å€</a></strong></p>

<p>â€œæ¥å—å…¶å®ƒå‡½æ•°ä½œä¸ºå‚æ•°çš„å‡½æ•°æœ‰æ—¶è¢«ç§°ä¸º <strong>é«˜é˜¶å‡½æ•°</strong> ã€‚æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨ä¸€äº›æ¥è‡ª Swift æ ‡å‡†åº“ä¸­ä½œç”¨äºæ•°ç»„çš„é«˜é˜¶å‡½æ•°ä¸­æ¼«æ¸¸ã€‚ä¼´éšè¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å°†ä»‹ç» Swift çš„ <strong>æ³›å‹</strong> ï¼Œä»¥åŠå±•ç¤ºå¦‚ä½•å°†å¤æ‚è®¡ç®—è¿ç”¨äºæ•°ç»„ã€‚â€</p>

<p>Swift ä¸­çš„ Array å’Œ Dictionary å…·æœ‰ mapï¼Œfliterï¼Œreduce ç­‰é«˜é˜¶å‡½æ•°ã€‚ç”¨äºè½¬æ¢ï¼Œç­›é€‰å’Œç»„åˆé‡Œé¢çš„å…ƒç´ </p>

<h3 id="map">map</h3>

<p>è½¬æ¢å‡½æ•°</p>
<h4 id="è‡ªå·±å®ç°ä¸€ä¸ª-map-å‡½æ•°">è‡ªå·±å®ç°ä¸€ä¸ª map å‡½æ•°</h4>
<p>Swift æ ‡å‡†åº“å·²ç»å®ç°äº† map å‡½æ•° (åŸºäº SequenceType åè®®è¢«å®šä¹‰ï¼Œéœ€è¦äº†è§£ä¸€ä¸‹ç”Ÿæˆå™¨å’Œåºåˆ—çš„çŸ¥è¯†)
å¦‚æœ <strong>è‡ªå·±å®ç°ä¸€ä¸ª map å‡½æ•°</strong> å¤§æ¦‚æ˜¯å¦‚ä¸‹ä»£ç </p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Array</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">map2</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">transform</span><span class="p">:</span> <span class="p">(</span><span class="kt">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">result</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="k">self</span> <span class="p">{</span>
            <span class="n">result</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">transform</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ä»£ç é‡Œè¾¹çš„ T å³æ˜¯ä¸€ä¸ª <strong>æ³›å‹</strong> ï¼Œåœ¨è°ƒç”¨æ—¶å€™ç»™å‡ºç¡®å®šçš„ç±»å‹å³å¯ã€‚è°ƒç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">exampleFiles</span> <span class="o">=</span> <span class="p">[</span><span class="s">"README.md"</span><span class="p">,</span> <span class="s">"HelloWorld.swift"</span><span class="p">,</span> <span class="s">"FlappyBird.swift"</span><span class="p">]</span>


<span class="k">let</span> <span class="nv">map3</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="n">map2</span> <span class="p">{</span> <span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Int</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">map3</span><span class="p">)</span>

</code></pre></div></div>

<p>ä¸ºä»€ä¹ˆç”¨ 3 ï¼Œå› ä¸ºæœ‰æ›´åŠ ç®€ä¾¿çš„ä¹¦å†™æ–¹å¼ï¼ŒSwift å¯ä»¥ç”¨ â€œ$0â€ ç­‰ä»·ä¸ºé—­åŒ…ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œâ€œ$1â€â€¦è¿™ç®—ä¸€ç§è¯­æ³•ç³–ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">map2</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="n">map2</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">count</span> <span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">map2</span><span class="p">)</span>

</code></pre></div></div>

<h4 id="ä½¿ç”¨-map-å‡½æ•°">ä½¿ç”¨ map å‡½æ•°</h4>

<p>è°ƒç”¨ç³»ç»Ÿçš„ map å‡½æ•°è·Ÿä¸Šè¾¹è‡ªå·±å®ç°çš„æ˜¯å·®ä¸å¤šçš„</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">map</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">count</span> <span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
<span class="c1">//[9, 16, 16]</span>

</code></pre></div></div>

<h4 id="ä½¿ç”¨-flatmap-å‡½æ•°">ä½¿ç”¨ flatMap å‡½æ•°</h4>

<blockquote>
  <p>flatMapè¿”å›åçš„æ•°ç»„ä¸­ä¸å­˜åœ¨ nil åŒæ—¶å®ƒä¼šæŠŠOptionalè§£åŒ…;
flatMap è¿˜èƒ½æŠŠæ•°ç»„ä¸­å­˜æœ‰æ•°ç»„çš„æ•°ç»„ ä¸€åŒæ‰“å¼€å˜æˆä¸€ä¸ªæ–°çš„æ•°ç»„ ;</p>
</blockquote>

<p><a href="http://www.cocoachina.com/swift/20160210/15068.html">Swift æ•°ç»„ä¸­ Map,FlatMap,Filter,Reduceçš„ä½¿ç”¨</a></p>

<p>ä¸€äº›ä¾‹å­ï¼š</p>

<p>ä¸ºäº†å±•ç¤ºï¼Œæ–°æ·»åŠ ä¸€ä¸ª arrï¼š exampleFiles2ã€‚</p>

<ul>
  <li>ä¾‹å­1ï¼šæ˜¯åˆ©ç”¨ flatMap å±•å¼€äº†æ•°ç»„</li>
  <li>ä¾‹å­2ï¼šæ˜¯åˆ©ç”¨ flatMap æ­£å¸¸éå†è½¬æ¢å…¶ä»–ç±»å‹çš„æƒ…å†µ</li>
  <li>ä¾‹å­3ï¼šå±•å¼€äº†æ•°ç»„ï¼Œå†å°†æ¯ä¸€ä¸ªå…ƒç´ è½¬æ¢ç±»å‹</li>
  <li>ä¾‹å­4ï¼šåˆ©ç”¨ map å±•å¼€äº†å¹¶ä¸”ç»„åˆï¼Œåˆ©ç”¨å¤–éƒ¨çš„ flatMap å±•å¼€ç»„åˆåçš„å…ƒç»„æ•°ç»„</li>
</ul>

<p><strong>æ³¨æ„ï¼šä¾‹å­2ä½¿ç”¨äº†compactMapï¼Œè¿™ä¸ªå¦‚ä½•è¿™ä¸ª Any å¯¹è±¡æ²¡æœ‰ count å€¼ï¼Œé‚£ä¹ˆå°±å›è¿”å› nilã€‚å¦‚æœä½¿ç”¨flatMapï¼Œåˆ™ä¼šè·³è¿‡ï¼ˆ å¯èƒ½æœ‰éšå¼ bugï¼Œæ‰€ä»¥ä¸æ¨èï¼‰ã€‚</strong></p>

<p><strong>æ³¨æ„ï¼šä¾‹å­3ä½¿ç”¨äº†ä¸¤ä¸ªé«˜é˜¶å‡½æ•°é“¾å¼è°ƒç”¨ï¼Œè¿™ä¼šä½¿æ•´ä¸ªè¡¨è¾¾å¼çš„å¤æ‚çš„ä¸Šå‡ï¼ˆO(n*n)ï¼‰ã€‚</strong></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">let</span> <span class="nv">exampleFiles2</span> <span class="o">=</span> <span class="p">[</span><span class="n">exampleFiles</span><span class="p">,</span> <span class="p">[</span><span class="s">""</span><span class="p">],</span> <span class="n">exampleFiles</span><span class="p">]</span>

<span class="k">let</span> <span class="nv">flatMap1</span> <span class="o">=</span> <span class="n">exampleFiles2</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="nv">$0</span> <span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">flatMap1</span><span class="p">)</span>
<span class="c1">//["README.md", "HelloWorld.swift", "FlappyBird.swift", "", "README.md", "HelloWorld.swift", "FlappyBird.swift"]</span>

<span class="c1">//'flatMap' is deprecated: Please use compactMap(_:) for the case where closure returns an optional value</span>
<span class="k">let</span> <span class="nv">flatMap2</span> <span class="o">=</span> <span class="n">exampleFiles2</span><span class="o">.</span><span class="n">compactMap</span><span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">count</span> <span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">flatMap2</span><span class="p">)</span>
<span class="c1">//[3, 1, 3]</span>

<span class="k">let</span> <span class="nv">flatMap3</span> <span class="o">=</span> <span class="n">exampleFiles2</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="nv">$0</span> <span class="p">}</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span><span class="nv">$0</span><span class="o">.</span><span class="n">count</span><span class="p">})</span>
<span class="nf">print</span><span class="p">(</span><span class="n">flatMap3</span><span class="p">)</span>
<span class="c1">//[9, 16, 16, 0, 9, 16, 16]</span>

<span class="k">let</span> <span class="nv">flatMap4</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">in</span>
    <span class="n">exampleFiles</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="p">(</span><span class="n">item2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span> <span class="k">in</span>
        <span class="nf">return</span> <span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">flatMap4</span><span class="p">)</span>
<span class="c1">//[("README.md", "README.md"), ("README.md", "README.md"), ("README.md", "README.md"), ("HelloWorld.swift", "HelloWorld.swift"), ("HelloWorld.swift", "HelloWorld.swift"), ("HelloWorld.swift", "HelloWorld.swift"), ("FlappyBird.swift", "FlappyBird.swift"), ("FlappyBird.swift", "FlappyBird.swift"), ("FlappyBird.swift", "FlappyBird.swift")]</span>
</code></pre></div></div>

<h4 id="å…³äºæ—¶é—´å¤æ‚åº¦">å…³äºæ—¶é—´å¤æ‚åº¦</h4>

<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è‡ªå·±çš„ map å‡½æ•°ï¼ŒéªŒè¯ç»„åˆå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œæ•°ç»„çš„éå†å®é™…æ‰§è¡Œäº†å‡ æ¬¡</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">extension</span> <span class="kt">Array</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">map2</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nv">transform</span><span class="p">:</span> <span class="p">(</span><span class="kt">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">result</span><span class="p">:</span> <span class="p">[</span><span class="kt">T</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="k">self</span> <span class="p">{</span>
            <span class="n">result</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">transform</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">let</span> <span class="nv">map4</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="n">map2</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">count</span> <span class="p">}</span><span class="o">.</span><span class="nf">map2</span><span class="p">(</span><span class="nv">transform</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">})</span>
<span class="nf">print</span><span class="p">(</span><span class="n">map4</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="fliter">fliter</h3>

<p>ç­›é€‰å‡½æ•°</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">filter</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="nf">filter</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="nf">hasSuffix</span><span class="p">(</span><span class="s">".swift"</span><span class="p">)</span> <span class="p">})</span>
<span class="nf">print</span><span class="p">(</span><span class="n">filter</span><span class="p">)</span>
<span class="c1">//["HelloWorld.swift", "FlappyBird.swift"]</span>
</code></pre></div></div>

<h3 id="reduce">reduce</h3>

<p>ä¿®æ”¹</p>

<p>æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªé›†åˆç±»å‹çš„ å¯¹è±¡è½¬æ¢ä¸ºå…¶ä»–éœ€è¦çš„å€¼</p>

<ul>
  <li>ä¾‹å­1ï¼šè½¬æ¢æˆç”¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸²</li>
  <li>ä¾‹å­2ï¼šç»Ÿè®¡æ–‡ä»¶ä¸ªæ•°</li>
</ul>

<p><strong>result[key, default: 0] += 1ï¼Œè¿™ä¸ªè¯­æ³•ç³–åœ¨ç¢°åˆ° key çš„æƒ…å†µä¸‹å°† Int å‹çš„ Value åŠ  1</strong></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">var</span> <span class="nv">reduceR</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">String</span> <span class="k">in</span>
    <span class="k">if</span> <span class="n">total</span><span class="o">.</span><span class="n">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">item</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">total</span> <span class="o">+</span> <span class="s">","</span> <span class="o">+</span> <span class="n">item</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">reduceR</span><span class="p">)</span>
<span class="c1">//README.md,HelloWorld.swift,FlappyBird.swift</span>

<span class="k">let</span> <span class="nv">reduceInto</span> <span class="o">=</span> <span class="n">exampleFiles</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="nv">into</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Int</span><span class="p">]())</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">let</span> <span class="nv">index</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="nf">lastIndex</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="s">"."</span><span class="p">)</span> <span class="p">??</span> <span class="n">item</span><span class="o">.</span><span class="n">startIndex</span>
    <span class="k">let</span> <span class="nv">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="nf">suffix</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="s">"</span><span class="se">\(</span><span class="n">key</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="k">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">reduceInto</span><span class="p">)</span>
<span class="c1">//[".md": 1, ".swift": 2]</span>

</code></pre></div></div>

<h4 id="å…³äºæ—¶é—´å¤æ‚åº¦-1">å…³äºæ—¶é—´å¤æ‚åº¦</h4>

<p>map - flatMap - ä¾‹å­2ï¼Œå› ä¸ºé“¾æ¥é«˜é˜¶å‡½æ•°å¯¼è‡´å¤æ‚åº¦æå‡çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ reduce å’Œ map å‡½æ•°ç»„åˆ <strong>ä¿®æ”¹è½¬æ¢</strong> å®ç°ã€‚</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">reduceInto2</span> <span class="o">=</span> <span class="n">exampleFiles2</span><span class="o">.</span><span class="nf">reduce</span><span class="p">(</span><span class="nv">into</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]())</span> <span class="p">{</span> <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="nf">map</span><span class="p">({</span> <span class="nv">$0</span><span class="o">.</span><span class="n">count</span> <span class="p">})</span>
<span class="p">}</span>
<span class="nf">print</span><span class="p">(</span><span class="n">reduceInto2</span><span class="p">)</span>
<span class="c1">//[9, 16, 16, 0, 9, 16, 16]</span>
</code></pre></div></div>

<h2 id="æ€»ç»“">æ€»ç»“</h2>

<p>å¯¹è¿™äº›å‡½æ•°å®ç°å’Œä½¿ç”¨ï¼Œæ›´åŠ æ¥è§¦åˆ°äº† æ³›å‹ï¼Œ Anyï¼Œ æ—¶é—´å¤æ‚åº¦ï¼Œä¸€äº›è¯­æ³•ç³–ç­‰çŸ¥è¯†ï¼Œè¿™ç¯‡æ–‡ç« åº”è¯¥æ˜¯å…¼é¡¾å…¥é—¨å’Œä½¿ç”¨äº†ã€‚ä½†æ˜¯å­¦ä»¥è‡´ç”¨ï¼Œè¿˜æ˜¯è¦åœ¨é¡¹ç›®ä¸­å¤šå¤šä½¿ç”¨æ‰èƒ½å·©å›ºæå‡ã€‚</p>
:ET