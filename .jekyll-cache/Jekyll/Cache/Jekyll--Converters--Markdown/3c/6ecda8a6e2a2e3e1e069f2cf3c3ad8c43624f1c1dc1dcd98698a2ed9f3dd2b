I"Ô<p><img src="https://docs.fastlane.tools/img/fastlane_text.png" alt="img" /></p>

<p>å†™åœ¨æ–‡ç« å‰çš„è¯ï¼šæœ‰é—®é¢˜å°±å»æŸ¥æ–‡æ¡£å’Œissuesï¼Œé”™ä¸äº†çš„</p>

<p>åˆ—ä¸¾ä¸€ä¸‹ åœ¨è‡ªå·±ç”µè„‘ä¸Šå¸¸ç”¨çš„åŠŸèƒ½</p>

<ul>
  <li>fastlane åœ¨ iOS ä¸‹å¯ä»¥å¾ˆå®¹æ˜“çš„ç®¡ç†è¯ä¹¦å’Œ p12æ–‡ä»¶</li>
  <li>å¾ˆå®¹æ˜“ä¿®æ”¹é¡¹ç›® versionï¼Œbuildï¼Œæˆªå›¾ç­‰éœ€è¦jæäº¤å®¡æ ¸çš„èµ„æºæ–‡ä»¶</li>
  <li>
    <p>xcode command lineè‡ªåŠ¨åŒ–æ‰“åŒ…ï¼Œæäº¤æµ‹è¯•</p>
  </li>
  <li>[CI]åœ¨ git æäº¤åˆ°æµ‹è¯•åˆ†æ”¯æ—¶å€™æ‰§è¡Œ CIï¼Œæ‰“åŒ…ä¸Šä¼ åˆ° TstFlightã€‚æ‰“ tag æ—¶å€™å°±ä¼šä¸Šä¼ å®¡æ ¸</li>
</ul>

<p><a href="https://docs.fastlane.tools/best-practices/continuous-integration/">å®˜æ–¹æ–‡æ¡£å…³äº CI çš„ä»‹ç»</a></p>

<h2 id="å®˜ç½‘æ–‡æ¡£-fastlane">å®˜ç½‘æ–‡æ¡£ ï¼š<a href="https://docs.fastlane.tools/">fastlane</a></h2>

<h3 id="github-æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¤¾åŒº-mythkivenad_fastlaneæœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­å’Œdemoå·¥ç¨‹å®ç°äº†ä»é›¶åˆ°è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼ çš„è¯¦ç»†æ“ä½œæ­¥éª¤">github æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¤¾åŒº ,<a href="https://github.com/mythkiven/AD_Fastlane">mythkiven/AD_Fastlane</a>æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå’ŒDemoå·¥ç¨‹ï¼Œå®ç°äº†ä»é›¶åˆ°è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼ çš„è¯¦ç»†æ“ä½œæ­¥éª¤ã€‚</h3>

<h3 id="å¦å¤–ä¸€ä¸ªæ–‡æ¡£åŒ…æ‹¬ä¸€äº›å¤šè¯­è¨€å’Œ-ciç­‰å¤„ç†fastlane-æŒç»­é›†æˆæ˜¯å¦ä¸€ä¸ªä¸€ä¸ªéå¸¸å¥½çš„æ•™å­¦æ–‡æ¡£">å¦å¤–ä¸€ä¸ªæ–‡æ¡£ï¼ŒåŒ…æ‹¬ä¸€äº›å¤šè¯­è¨€ã€å’Œ CIç­‰å¤„ç†ã€‚<a href="https://juejin.im/post/5a7b10bb6fb9a0636263bfd5">fastlane æŒç»­é›†æˆ</a>ï¼Œæ˜¯å¦ä¸€ä¸ªä¸€ä¸ªéå¸¸å¥½çš„æ•™å­¦æ–‡æ¡£ã€‚</h3>

<p>è¿˜æœ‰å¯ä»¥ googleåˆ°å¾ˆå¤šéå¸¸æœ‰ç”¨çš„åšå®¢èµ„æ–™ã€‚ä½†æ˜¯æ®è‡ªå·±å®è·µæ¥çœ‹ï¼Œå¾ˆå¤šæ–‡æ¡£ä½ åªéœ€è¦è¿”å›å»çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥è§£å†³ã€‚</p>

<h2 id="ä»‹ç»ä¸€ä¸‹è‡ªå·±ç”¨åˆ°çš„ä¸€äº›è„šæœ¬">ä»‹ç»ä¸€ä¸‹è‡ªå·±ç”¨åˆ°çš„ä¸€äº›è„šæœ¬</h2>

<p>å¦‚æœæƒ³å­¦ä¹  Ruby è„šæœ¬è¯­è¨€å¯ä»¥åˆ°è¿™é‡Œï¼š<strong><a href="https://www.kancloud.cn/imxieke/ruby-base/107282">Ruby æ–‡æ¡£</a></strong></p>

<h3 id="åœ¨ç®¡ç†å‘˜ç”µè„‘æ‰“åŒ…æœºå™¨ä¸Šä¸€äº›æœ‰ç”¨çš„è„šæœ¬">åœ¨ç®¡ç†å‘˜ç”µè„‘/æ‰“åŒ…æœºå™¨ä¸Šä¸€äº›æœ‰ç”¨çš„è„šæœ¬</h3>

<ul>
  <li>æ³¨å†Œæ–°çš„è®¾å¤‡</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>desc "register device"
lane :new_devices do
    register_devices(devices_file: "./devices.txt")
    match(type: "develop", force_for_new_devices: true)
end

</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>æäº¤æµ‹è¯•ã€æäº¤å®¡æ ¸ï¼Œè¿™äº›è„šæœ¬ä¹Ÿå¯ä»¥åœ¨åˆ†æ”¯æ¡ä»¶è¢«è§¦å‘æ—¶å€™è°ƒç”¨</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre>lane :beta do
    build
    upload_to_testflight(ipa: './build/Zhima_iOS.ipa',
                         changelog: 'å¢åŠ è¯„è®ºåŠŸèƒ½',
                         groups: ['beta'],
                         demo_account_required: true,
                         skip_waiting_for_build_processing: true)
end

lane :release do
    build
    upload_to_app_store(ipa: './build/Zhima_iOS.ipa',
                        force: true,
                        submit_for_review: false,
                        automatic_release: false)
end

lane :release_from_beta do
    upload_to_app_store(
                        build_number: get_build_number,
                        skip_binary_upload: true,
                        force: true,
                        submit_for_review: true,
                        automatic_release: false)
end
</pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="åœ¨å¼€å‘è€…ç”µè„‘ä¸Šä¸€äº›æœ‰ç”¨çš„è„šæœ¬">åœ¨å¼€å‘è€…ç”µè„‘ä¸Šä¸€äº›æœ‰ç”¨çš„è„šæœ¬</h3>

<ul>
  <li>åŒæ­¥è¯ä¹¦</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>lane :setup do
    match(type: 'development', readonly: true)
    match(type: 'appstore', readonly: true)
    match(type: 'adhoc', readonly: true)
end
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>è®¾ç½®é¡¹ç›®çš„ version numberã€build number</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre>lane :set_version do
    if UI.interactive?
        changelog = UI.input "Please enter the new version number: "
    end
    increment_version_number(
                             version_number: "#{changelog}"
                             )
end

lane :set_build_number do
    if UI.interactive?
        changelog = UI.input "Please enter the new build numbe: "
    end
    increment_version_number(
                             build_number: "#{changelog}"
                             )
end

lane :increase_build_number do
    updateProjectBuildNumber
end



# è¿™æ˜¯å®šä¹‰åœ¨ Fastlane æ–‡ä»¶ä¹‹å¤–çš„ä¸€æ®µè„šæœ¬ï¼Œç›®çš„æ˜¯è®¾ç½®å½“å‰çš„build ä¸ºæ—¥æœŸåŠ ç‰ˆæœ¬
def updateProjectBuildNumber
    currentTime = Time.new.strftime("%y%m%d")
    build = get_build_number()

    if build.include?"#{currentTime}"

        # =&gt; ä¸ºå½“å¤©ç‰ˆæœ¬ è®¡ç®—è¿­ä»£ç‰ˆæœ¬å·
        lastStr = build[build.length-1]
        lastNum = lastStr.to_i

        if lastNum == 9

            UI.error " ğŸš«  error =&gt;  buildæœ«ä½å·²ç»æ˜¯ 9 "
            return
        end

        lastNum = lastNum +1
        build ="#{currentTime}#{lastNum}"

        else

        # =&gt; éå½“å¤©ç‰ˆæœ¬ build å·é‡ç½®
        build ="#{currentTime}0"
    end

    puts("*************| æ›´æ–°build #{build} |*************")

    # =&gt; æ›´æ”¹é¡¹ç›® build å·
    increment_build_number(
                           build_number:"#{build}"
                           )
end
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>ç”¨æ¨¡æ‹Ÿå™¨æµ‹è¯•ã€æ‰“åŒ…ipa</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>lane :tests do
    run_tests(scheme: "Project", devices: ["iPhone 8"])
end

lane :build do
    build_app(scheme: 'Project',
              output_directory: './build')
end
</pre></td></tr></tbody></table></code></pre></div></div>

<ul>
  <li>è¿è¡Œ swiftlint</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>    desc "run swiftlint"
    lane :lint do
        swiftlint( strict: true )
    end

</pre></td></tr></tbody></table></code></pre></div></div>

<p>æš‚æ—¶è¿™äº›åŠŸèƒ½å§â€¦</p>
:ET