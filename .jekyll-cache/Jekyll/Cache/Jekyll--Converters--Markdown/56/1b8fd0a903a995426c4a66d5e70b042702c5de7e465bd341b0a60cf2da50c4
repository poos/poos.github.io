I"¥<blockquote>
  <p>å½“ä¸€ä¸ªç±»åŒ…å«äº†å¤ªå¤šçš„å¤ªæ‚çš„å†…å®¹ï¼Œå®ƒå°±å˜å¾—å¤æ‚äº†ï¼ŒæŠŠå…¶ä¸­çš„å†…å®¹æŠ½å‡ºæ¥ï¼Œç”¨åè®®ç®¡ç†çº¦æŸï¼Œé¡¹ç›®æ‰ä¼šæ›´æ¸…æ™°ã€‚</p>
</blockquote>

<h2 id="åˆ†äº«è°ƒç”¨çš„è®¾è®¡æ–¹æ¡ˆ-protocol-class">åˆ†äº«è°ƒç”¨çš„è®¾è®¡æ–¹æ¡ˆ Protocol-Class</h2>

<p>æŸç§æ„ä¹‰ä¸Šï¼Œä¸åŒé¡µé¢è°ƒç”¨åˆ†äº«ä¹Ÿå¯ä»¥ç†è§£ä¸ºç»§æ‰¿é‡è½½çš„å…³ç³»â€”&gt;è€Œç»§æ‰¿é‡è½½å¯ä»¥ç”¨åè®®å®Œç¾è§£å†³</p>

<h4 id="åè®®-ç±»ç»“æ„ä½“å’Œæšä¸¾">åè®® ç±»ã€ç»“æ„ä½“å’Œæšä¸¾</h4>
<p><a href="https://blog.csdn.net/Lirx_Tech/article/details/41724185">å‚è€ƒèµ„æ–™</a></p>

<ul>
  <li>
    <p>å…¶å®å°±æ˜¯Javaä¸­çš„æ¥å£ï¼ŒSwiftçš„éµå®ˆåè®®å°±æ˜¯Javaä¸­çš„å®ç°æ¥å£ï¼Œå¦‚æœæ”¾åœ¨C++ä¸­å°±æ˜¯çº¯è™šç±»çš„æ¦‚å¿µï¼Œå³åè®®å°±æ˜¯ä¸€ç§é«˜åº¦æŠ½è±¡çš„æŠ½è±¡ç±»ï¼Œé‡Œé¢å€¼è§„å®šäº†æ–¹æ³•ã€å±æ€§ç­‰å†…å®¹ï¼Œä½†æ²¡æœ‰æä¾›ä»»ä½•å®ç°ï¼Œæ‰€æœ‰éµå®ˆè¯¥åè®®çš„ç±»ã€ç»“æ„ä½“æˆ–æšä¸¾éƒ½å¿…é¡»å®ç°åè®®ä¸­è§„å®šçš„å†…å®¹ï¼Œåªä¸è¿‡C++æ²¡æœ‰æ¥å£è€Œåªèƒ½é€šè¿‡ç»§æ‰¿è™šåŸºç±»æ¥å®ç°å…¶ä¸­çš„å†…å®¹è€Œå·²ï¼›</p>
  </li>
  <li>
    <p>åè®®æ˜¯é¢å‘æ¥å£ç¼–ç¨‹çš„å¿…ä¸å¯å°‘çš„æœºåˆ¶ï¼Œå…¶è¦æ±‚å®šä¹‰ä¸å®ç°åˆ†ç¦»ï¼Œåœ¨Javaå’ŒSwiftä¸­éƒ½å¯ä»¥å°†åè®®ä½œä¸ºæ•°æ®ç±»å‹ï¼ˆå°±å’Œå…¶å®ƒæ™®é€šçš„æ•°æ®ç±»å‹Intã€Arrayç­‰ï¼‰æš´éœ²ç»™ä½¿ç”¨è€…ï¼Œè€Œä½¿ç”¨è€…ä¸ç”¨å…³å¿ƒå…·ä½“çš„å®ç°ç»†èŠ‚ï¼›</p>
  </li>
  <li>
    <p>åè®®ä¸­å¯ä»¥å®šä¹‰çš„å†…å®¹ï¼šè®¡ç®—å±æ€§ï¼ˆå®ä¾‹/é™æ€ï¼‰ã€æ–¹æ³•ï¼ˆå®ä¾‹/é™æ€ï¼‰å’Œä¸‹æ ‡</p>
  </li>
</ul>

<h4 id="å®ç°">å®ç°</h4>

<p>è¿™é‡Œå®ä¾‹è°ƒç”¨åˆ†äº«çš„å‡ ä¸ªåœ°æ–¹</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//å¯èƒ½æ˜¯ VC</span>
<span class="c1">//å¯èƒ½æ˜¯ View</span>
<span class="c1">//å¯èƒ½æ˜¯ WebView</span>
<span class="c1">//å¯ä»¥æ˜¯ ä»»ä½•ç±»</span>
<span class="kd">class</span> <span class="kt">A</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="n">xx</span> <span class="p">{</span>
        <span class="nf">share</span><span class="p">()</span><span class="c1">//è°ƒç”¨åè®®æ–¹æ³•</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">jsShare</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">share</span><span class="p">()</span><span class="c1">//è°ƒç”¨åè®®æ–¹æ³•</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">jsShareMoment</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">shareMoment</span><span class="p">()</span><span class="c1">//è°ƒç”¨åè®®æ–¹æ³•</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>è¿™é‡Œæ˜¯åè®®åˆ†å‘ç®¡ç†çš„ protocolç±», åœ¨è¿™é‡Œå®ç°åˆ†äº«çš„æ–¹æ³•</p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// å®šä¹‰ç»Ÿä¸€çš„åè®®</span>
<span class="kd">extension</span> <span class="kt">A</span><span class="p">:</span> <span class="kt">ShareProtocol</span><span class="p">,</span> <span class="kt">ShareProtocol2</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">share</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//...</span>
    <span class="p">}</span>
    <span class="kd">func</span> <span class="nf">shareMoment</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">//...</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h4 id="æ€»ç»“">æ€»ç»“</h4>

<p>é€šè¿‡è¿™ç§è®¾è®¡ï¼ŒShareManageræ›´åŠ å½»åº•çš„è´Ÿè´£æ‰€æœ‰çš„åˆ†äº«äº‹å®œï¼›VC åªæ˜¯ç®€å•è°ƒç”¨ï¼Œé¡µé¢ç»“æ„æ›´ç®€å•äº†ã€‚</p>

<hr />
<blockquote>

  <hr />
</blockquote>

<h2 id="åˆ†äº«åŠŸèƒ½å®ç°çš„æ¡†æ¶">åˆ†äº«åŠŸèƒ½å®ç°çš„æ¡†æ¶</h2>

<h2 id="åˆ†äº«æ¡†æ¶">åˆ†äº«æ¡†æ¶</h2>

<p>åˆ†äº«çš„å…·ä½“å®ç°å°±ä¸å¿…ç»†è¯´äº†</p>

<table>
  <thead>
    <tr>
      <th>File</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Model</td>
      <td>åˆ†äº«æ¨¡å‹</td>
    </tr>
    <tr>
      <td>View</td>
      <td>åˆ†äº«è§†å›¾</td>
    </tr>
    <tr>
      <td>ViewControl</td>
      <td>å¤„ç†å¼¹å‡ºåŠ¨ç”»; åˆ†æµé€‰å®šåçš„æ“ä½œ</td>
    </tr>
    <tr>
      <td>Manager</td>
      <td>å°è£…å„ä¸ªSDKåˆ†äº«æ–¹æ³•</td>
    </tr>
  </tbody>
</table>

<blockquote>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>func present() {
let model = ShareModel()
...
    AppShareViewControl.present(model) }
</code></pre></div>  </div>
</blockquote>

<blockquote>

</blockquote>

<h2 id="model">Model</h2>

<blockquote>
  <p>ç•¥å»</p>
</blockquote>

<h2 id="view">View</h2>
<blockquote>
  <p>skip</p>
</blockquote>

<h2 id="viewcontrol">ViewControl</h2>

<p>view çš„ä¸€äº›åŠ¨ç”»ï¼Œå¤§éƒ¨åˆ†ç®€å•çš„åŠ¨ç”»å°±ä¸å†ä»‹ç»ã€‚</p>

<p><strong>è®¾ç½®æŒ‰é¡ºåºå¼¹å‡ºåŠ¨ç”»,layoutä½ç§»åŠ¨ç”»</strong></p>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

    <span class="kd">static</span> <span class="kd">private</span> <span class="kd">func</span> <span class="nf">buttonsAnimation</span><span class="p">(</span><span class="nv">buttons</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIView</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span> <span class="k">in</span> <span class="n">buttons</span><span class="o">.</span><span class="nf">enumerated</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">button</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="mi">375</span><span class="p">,</span> <span class="nv">forKeyPath</span><span class="p">:</span> <span class="s">"transform.translation.y"</span><span class="p">)</span>
            <span class="n">button</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="kt">UIView</span><span class="o">.</span><span class="nf">animate</span><span class="p">(</span><span class="nv">withDuration</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
                           <span class="nv">delay</span><span class="p">:</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="kt">Double</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
                           <span class="nv">usingSpringWithDamping</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                           <span class="nv">initialSpringVelocity</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
                           <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="n">curveEaseInOut</span><span class="p">,</span>
                           <span class="nv">animations</span><span class="p">:</span> <span class="p">{</span>
                           <span class="n">button</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
                           <span class="n">button</span><span class="o">.</span><span class="n">layer</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nv">forKeyPath</span><span class="p">:</span> <span class="s">"transform.translation.y"</span><span class="p">)</span>
                           <span class="p">})</span>
    <span class="p">}</span>

</code></pre></div></div>

<h2 id="manager">Manager</h2>

<h4 id="è°ƒç”¨ç³»ç»Ÿåˆ†äº«">è°ƒç”¨ç³»ç»Ÿåˆ†äº«</h4>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// MARK: - ç³»ç»Ÿ</span>
    <span class="c1">//ç³»ç»Ÿåˆ†äº«ä¼ å…¥[String, UIImage, URL]</span>
    <span class="c1">//æ³¨æ„:ç³»ç»Ÿåˆ†äº«qqä¼šè°ƒç”¨URL å¯¹åº”çš„webæ›´æ–°æ•°æ®,è‹¥æ²¡æœ‰å¯¹åº”webé¡µï¼ˆé H5é¡µï¼‰ä¼šæ˜¾ç¤ºå¼‚å¸¸</span>
    <span class="kd">func</span> <span class="nf">shareSystem</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">content</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">?,</span> <span class="nv">link</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">items</span><span class="p">:</span> <span class="p">[</span><span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">title</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">256</span> <span class="p">{</span>
            <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">((</span><span class="n">title</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="mi">255</span><span class="p">))</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nv">thumbimage</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">if</span> <span class="n">image</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="n">thumbimage</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"AppIconSmall"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">thumbimage</span><span class="o">!.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">70</span> <span class="p">{</span>
            <span class="n">thumbimage</span> <span class="o">=</span> <span class="nf">imageCompressSize</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">thumbimage</span><span class="o">!</span><span class="p">,</span> <span class="nv">size</span><span class="p">:</span> <span class="kt">CGSize</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">70</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">thumbimage</span><span class="o">!</span> <span class="k">as</span> <span class="kt">Any</span><span class="p">)</span>
        <span class="n">items</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">URL</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">link</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">activity</span> <span class="o">=</span> <span class="kt">UIActivityViewController</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">activityItems</span><span class="p">:</span> <span class="n">items</span><span class="p">,</span> <span class="nv">applicationActivities</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
        <span class="kt">UIViewController</span><span class="o">.</span><span class="nf">currentViewController</span><span class="p">()</span><span class="o">.</span><span class="nf">presentVC</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="è°ƒç”¨å¾®ä¿¡åˆ†äº«å»ºè®®ä¼˜åŒ–ä½¿ç”¨-model">è°ƒç”¨å¾®ä¿¡åˆ†äº«(å»ºè®®ä¼˜åŒ–ä½¿ç”¨ model)</h4>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">share</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="kt">Int</span><span class="p">,</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">content</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">?,</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="kt">WXApi</span><span class="o">.</span><span class="nf">isWXAppInstalled</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">popview</span> <span class="o">=</span> <span class="kt">PopupView</span><span class="p">()</span>
            <span class="n">popview</span><span class="o">.</span><span class="nf">popupText</span><span class="p">(</span><span class="o">.</span><span class="n">noWechat</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="kt">WXMediaMessage</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">256</span> <span class="p">{</span>
            <span class="n">message</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="n">title</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="mi">255</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">message</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">description</span> <span class="o">=</span> <span class="n">content</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">description</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">512</span> <span class="p">{</span>
                <span class="n">message</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="p">(</span><span class="n">description</span> <span class="k">as</span> <span class="kt">NSString</span><span class="p">)</span><span class="o">.</span><span class="nf">substring</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="mi">511</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">message</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">var</span> <span class="nv">thumbimage</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">if</span> <span class="n">image</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="n">thumbimage</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"AppIconSmall"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">thumbimage</span><span class="o">!.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="mi">70</span> <span class="p">{</span>
            <span class="n">thumbimage</span> <span class="o">=</span> <span class="nf">imageCompressSize</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">thumbimage</span><span class="o">!</span><span class="p">,</span> <span class="nv">size</span><span class="p">:</span> <span class="kt">CGSize</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">70</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">70</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span> <span class="o">=</span> <span class="nf">imageCompressData</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">thumbimage</span><span class="o">!</span><span class="p">,</span> <span class="nv">max</span><span class="p">:</span> <span class="mi">32</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">message</span><span class="o">.</span><span class="n">thumbData</span> <span class="o">=</span> <span class="n">data</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">webpage</span> <span class="o">=</span> <span class="kt">WXWebpageObject</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="n">webpage</span><span class="o">.</span><span class="n">webpageUrl</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">message</span><span class="o">.</span><span class="n">mediaObject</span> <span class="o">=</span> <span class="n">webpage</span>

        <span class="k">let</span> <span class="nv">send</span> <span class="o">=</span> <span class="kt">SendMessageToWXReq</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="n">send</span><span class="o">.</span><span class="n">bText</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">send</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="k">let</span> <span class="nv">scene</span> <span class="o">=</span> <span class="n">type</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">?</span> <span class="kt">WXSceneSession</span> <span class="p">:</span> <span class="kt">WXSceneTimeline</span>
        <span class="n">send</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="kt">Int32</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">rawValue</span><span class="p">)</span>

        <span class="kt">WXApi</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">send</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">share</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="kt">WXApi</span><span class="o">.</span><span class="nf">isWXAppInstalled</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">popview</span> <span class="o">=</span> <span class="kt">PopupView</span><span class="p">()</span>
            <span class="n">popview</span><span class="o">.</span><span class="nf">popupText</span><span class="p">(</span><span class="o">.</span><span class="n">noWechat</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="p">}</span>

        <span class="k">let</span> <span class="nv">message</span> <span class="o">=</span> <span class="kt">WXMediaMessage</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>

        <span class="c1">// imageæœ€å¤§10M</span>
        <span class="k">let</span> <span class="nv">wxImage</span> <span class="o">=</span> <span class="kt">WXImageObject</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span> <span class="o">=</span> <span class="nf">imageCompressData</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="nv">max</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">wxImage</span><span class="o">.</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">data</span>
        <span class="p">}</span>
        <span class="n">message</span><span class="o">.</span><span class="n">mediaObject</span> <span class="o">=</span> <span class="n">wxImage</span>

        <span class="k">let</span> <span class="nv">send</span> <span class="o">=</span> <span class="kt">SendMessageToWXReq</span><span class="o">.</span><span class="nf">init</span><span class="p">()</span>
        <span class="n">send</span><span class="o">.</span><span class="n">bText</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="n">send</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="n">send</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="kt">Int32</span><span class="p">(</span><span class="kt">WXSceneSession</span><span class="o">.</span><span class="n">rawValue</span><span class="p">)</span>

        <span class="kt">WXApi</span><span class="o">.</span><span class="nf">send</span><span class="p">(</span><span class="n">send</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></div></div>

<h4 id="å‹ç¼©å›¾ç‰‡ç­‰æ–¹æ³•">å‹ç¼©å›¾ç‰‡ç­‰æ–¹æ³•</h4>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// MARK: - é€šç”¨</span>
    <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">imageCompressSize</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">,</span> <span class="n">size</span> <span class="nv">length</span><span class="p">:</span> <span class="kt">CGFloat</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">UIImage</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">&gt;</span> <span class="n">length</span> <span class="o">||</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">&gt;</span> <span class="n">length</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="n">image</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">rect</span><span class="p">:</span> <span class="kt">CGRect</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">&lt;</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">calc</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">calc</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">calc</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="kt">CGRect</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="n">calc</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">cgImage</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">cgImage</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">newCgImage</span> <span class="o">=</span> <span class="n">cgImage</span><span class="o">.</span><span class="nf">cropping</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">rect</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="n">image</span> <span class="p">}</span>
        <span class="k">let</span> <span class="nv">newImage</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">cgImage</span><span class="p">:</span> <span class="n">newCgImage</span><span class="p">)</span>

        <span class="k">var</span> <span class="nv">result</span> <span class="o">=</span> <span class="n">newImage</span>
        <span class="kt">UIGraphicsBeginImageContext</span><span class="p">(</span><span class="kt">CGSize</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="n">length</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">length</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="nf">draw</span><span class="p">(</span><span class="nv">in</span><span class="p">:</span> <span class="kt">CGRect</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">y</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">width</span><span class="p">:</span> <span class="n">length</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="n">length</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="kt">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">()</span> <span class="p">??</span> <span class="n">image</span>
        <span class="kt">UIGraphicsEndImageContext</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>

    <span class="kd">fileprivate</span> <span class="kd">func</span> <span class="nf">imageCompressData</span><span class="p">(</span><span class="nv">image</span><span class="p">:</span> <span class="kt">UIImage</span><span class="p">,</span> <span class="nv">max</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Data</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">strength</span><span class="p">:</span> <span class="kt">CGFloat</span> <span class="o">=</span> <span class="mf">0.99</span>
        <span class="k">var</span> <span class="nv">data</span> <span class="o">=</span> <span class="kt">UIImageJPEGRepresentation</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">strength</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="n">data</span><span class="o">!.</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">max</span> <span class="o">*</span> <span class="mi">1024</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">strength</span> <span class="o">&lt;</span> <span class="mf">0.4</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">named</span><span class="p">:</span> <span class="s">"AppIconSmall"</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="kt">UIImageJPEGRepresentation</span><span class="p">(</span><span class="n">image</span><span class="o">!</span><span class="p">,</span> <span class="n">strength</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="p">}</span>
            <span class="n">strength</span> <span class="o">-=</span> <span class="mf">0.1</span>
            <span class="n">data</span> <span class="o">=</span> <span class="kt">UIImageJPEGRepresentation</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">strength</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">data</span>
    <span class="p">}</span>
</code></pre></div></div>

<h4 id="åˆ†äº«å›è°ƒ">åˆ†äº«å›è°ƒ</h4>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// MARK: - SDKå›è°ƒ</span>
    <span class="kd">extension</span> <span class="kt">AppDelegate</span><span class="p">:</span> <span class="kt">WXApiDelegate</span> <span class="p">{</span>

    <span class="kd">@available</span><span class="p">(</span><span class="n">iOS</span><span class="p">,</span> <span class="nv">obsoleted</span><span class="p">:</span> <span class="mf">9.0</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">application</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="n">openURL</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">NSURL</span><span class="p">,</span> <span class="nv">sourceApplication</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="nv">annotation</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">sourceApp</span> <span class="o">=</span> <span class="n">sourceApplication</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">sourceApp</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"tencent.xin"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kt">WXApi</span><span class="o">.</span><span class="nf">handleOpen</span><span class="p">(</span><span class="n">url</span> <span class="k">as</span> <span class="kt">URL</span><span class="p">?,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">sourceApp</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"xxx"</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kt">WKAuth</span><span class="o">.</span><span class="nf">handleOpen</span><span class="p">(</span><span class="n">url</span> <span class="k">as</span> <span class="kt">URL</span><span class="p">?,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="kt">WifiService</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="kd">@available</span><span class="p">(</span><span class="n">iOS</span> <span class="mf">9.0</span><span class="p">,</span> <span class="o">*</span><span class="p">)</span>
    <span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">app</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span> <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationOpenURLOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">appName</span><span class="p">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">options</span><span class="p">[</span><span class="kt">UIApplicationOpenURLOptionsKey</span><span class="o">.</span><span class="n">sourceApplication</span><span class="p">]</span> <span class="k">as!</span> <span class="kt">String</span>
        <span class="k">if</span> <span class="n">appName</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"tencent.xin"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">WXApi</span><span class="o">.</span><span class="nf">handleOpen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="k">self</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">appName</span><span class="o">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"xxx"</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kt">WKAuth</span><span class="o">.</span><span class="nf">handleOpen</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="nv">delegate</span><span class="p">:</span> <span class="kt">WifiService</span><span class="o">.</span><span class="n">shared</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>

    <span class="c1">//æœªä½¿ç”¨</span>
    <span class="kd">func</span> <span class="nf">onReq</span><span class="p">(</span><span class="n">_</span> <span class="nv">req</span><span class="p">:</span> <span class="kt">BaseReq</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">req</span> <span class="o">.</span><span class="nf">isKind</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">GetMessageFromWXReq</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//å¾®ä¿¡è¯·æ±‚Appæä¾›å†…å®¹ï¼Œ éœ€è¦appæä¾›å†…å®¹åä½¿ç”¨sendRspè¿”å›</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">req</span> <span class="o">.</span><span class="nf">isKind</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">ShowMessageFromWXReq</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//æ˜¾ç¤ºå¾®ä¿¡ä¼ è¿‡æ¥çš„å†…å®¹</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="n">req</span> <span class="o">.</span><span class="nf">isKind</span><span class="p">(</span><span class="nv">of</span><span class="p">:</span> <span class="kt">LaunchFromWXReq</span><span class="o">.</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//ä»å¾®ä¿¡å¯åŠ¨App</span>
    <span class="p">}</span>
<span class="p">}</span>

    <span class="kd">func</span> <span class="nf">onResp</span><span class="p">(</span><span class="n">_</span> <span class="nv">resp</span><span class="p">:</span> <span class="kt">BaseResp</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">popview</span> <span class="o">=</span> <span class="kt">PopupView</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">resp</span><span class="o">.</span><span class="n">errCode</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
            <span class="n">popview</span><span class="o">.</span><span class="nf">popupType</span><span class="p">(</span><span class="o">.</span><span class="n">success</span><span class="p">,</span> <span class="o">.</span><span class="n">shareSuccess</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">popview</span><span class="o">.</span><span class="nf">popupType</span><span class="p">(</span><span class="o">.</span><span class="n">failed</span><span class="p">,</span> <span class="o">.</span><span class="n">shareFailed</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
:ET