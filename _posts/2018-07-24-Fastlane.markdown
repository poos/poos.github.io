---
layout:     post
title:      Fastlaneï¼ŒAppé…ç½®å’Œéƒ¨ç½²çš„åˆ©å™¨
subtitle:   fastlaneæ˜¯ä¸ºiOSå’ŒAndroidåº”ç”¨ç¨‹åºè‡ªåŠ¨æ‰§è¡Œbetaéƒ¨ç½²å’Œå‘å¸ƒçš„æœ€ç®€å•æ–¹æ³•ã€‚ğŸš€å®ƒå¤„ç†æ‰€æœ‰ç¹ççš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç”Ÿæˆå±å¹•æˆªå›¾ï¼Œå¤„ç†ä»£ç ç­¾åå’Œå‘å¸ƒåº”ç”¨ç¨‹åºã€‚
date:       2018-07-24
author:     poos
header-img: img/post-bg-2015.jpg
catalog: true
tags:
- å·¥å…·
---



![img](https://docs.fastlane.tools/img/fastlane_text.png)


å†™åœ¨æ–‡ç« å‰çš„è¯ï¼šæœ‰é—®é¢˜å°±å»æŸ¥æ–‡æ¡£å’Œissuesï¼Œé”™ä¸äº†çš„

åˆ—ä¸¾ä¸€ä¸‹ åœ¨è‡ªå·±ç”µè„‘ä¸Šå¸¸ç”¨çš„åŠŸèƒ½

- fastlane åœ¨ iOS ä¸‹å¯ä»¥å¾ˆå®¹æ˜“çš„ç®¡ç†è¯ä¹¦å’Œ p12æ–‡ä»¶
- å¾ˆå®¹æ˜“ä¿®æ”¹é¡¹ç›® versionï¼Œbuildï¼Œæˆªå›¾ç­‰éœ€è¦jæäº¤å®¡æ ¸çš„èµ„æºæ–‡ä»¶
- xcode command lineè‡ªåŠ¨åŒ–æ‰“åŒ…ï¼Œæäº¤æµ‹è¯•

- [CI]åœ¨ git æäº¤åˆ°æµ‹è¯•åˆ†æ”¯æ—¶å€™æ‰§è¡Œ CIï¼Œæ‰“åŒ…ä¸Šä¼ åˆ° TstFlightã€‚æ‰“ tag æ—¶å€™å°±ä¼šä¸Šä¼ å®¡æ ¸

[å®˜æ–¹æ–‡æ¡£å…³äº CI çš„ä»‹ç»](https://docs.fastlane.tools/best-practices/continuous-integration/)





## å®˜ç½‘æ–‡æ¡£ ï¼š[fastlane](https://docs.fastlane.tools/)


### github æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç¤¾åŒº ,[mythkiven/AD_Fastlane](https://github.com/mythkiven/AD_Fastlane)æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå’ŒDemoå·¥ç¨‹ï¼Œå®ç°äº†ä»é›¶åˆ°è‡ªåŠ¨æ‰“åŒ…ä¸Šä¼ çš„è¯¦ç»†æ“ä½œæ­¥éª¤ã€‚

### å¦å¤–ä¸€ä¸ªæ–‡æ¡£ï¼ŒåŒ…æ‹¬ä¸€äº›å¤šè¯­è¨€ã€å’Œ CIç­‰å¤„ç†ã€‚[fastlane æŒç»­é›†æˆ](https://juejin.im/post/5a7b10bb6fb9a0636263bfd5)ï¼Œæ˜¯å¦ä¸€ä¸ªä¸€ä¸ªéå¸¸å¥½çš„æ•™å­¦æ–‡æ¡£ã€‚

è¿˜æœ‰å¯ä»¥ googleåˆ°å¾ˆå¤šéå¸¸æœ‰ç”¨çš„åšå®¢èµ„æ–™ã€‚ä½†æ˜¯æ®è‡ªå·±å®è·µæ¥çœ‹ï¼Œå¾ˆå¤šæ–‡æ¡£ä½ åªéœ€è¦è¿”å›å»çœ‹å®˜æ–¹æ–‡æ¡£å°±å¯ä»¥è§£å†³ã€‚


## ä»‹ç»ä¸€ä¸‹è‡ªå·±ç”¨åˆ°çš„ä¸€äº›è„šæœ¬

å¦‚æœæƒ³å­¦ä¹  Ruby è„šæœ¬è¯­è¨€å¯ä»¥åˆ°è¿™é‡Œï¼š**[Ruby æ–‡æ¡£](https://www.kancloud.cn/imxieke/ruby-base/107282)**


### åœ¨ç®¡ç†å‘˜ç”µè„‘/æ‰“åŒ…æœºå™¨ä¸Šä¸€äº›æœ‰ç”¨çš„è„šæœ¬

- æ³¨å†Œæ–°çš„è®¾å¤‡

```
desc "register device"
lane :new_devices do
    register_devices(devices_file: "./devices.txt")
    match(type: "develop", force_for_new_devices: true)
end

```

- æäº¤æµ‹è¯•ã€æäº¤å®¡æ ¸ï¼Œè¿™äº›è„šæœ¬ä¹Ÿå¯ä»¥åœ¨åˆ†æ”¯æ¡ä»¶è¢«è§¦å‘æ—¶å€™è°ƒç”¨

```
lane :beta do
    build
    upload_to_testflight(ipa: './build/Zhima_iOS.ipa',
                         changelog: 'å¢åŠ è¯„è®ºåŠŸèƒ½',
                         groups: ['beta'],
                         demo_account_required: true,
                         skip_waiting_for_build_processing: true)
end

lane :release do
    build
    upload_to_app_store(ipa: './build/Zhima_iOS.ipa',
                        force: true,
                        submit_for_review: false,
                        automatic_release: false)
end

lane :release_from_beta do
    upload_to_app_store(
                        build_number: get_build_number,
                        skip_binary_upload: true,
                        force: true,
                        submit_for_review: true,
                        automatic_release: false)
end
```

### åœ¨å¼€å‘è€…ç”µè„‘ä¸Šä¸€äº›æœ‰ç”¨çš„è„šæœ¬

- åŒæ­¥è¯ä¹¦

```    
lane :setup do
    match(type: 'development', readonly: true)
    match(type: 'appstore', readonly: true)
    match(type: 'adhoc', readonly: true)
end
```

- è®¾ç½®é¡¹ç›®çš„ version numberã€build number

```    
lane :set_version do
    if UI.interactive?
        changelog = UI.input "Please enter the new version number: "
    end
    increment_version_number(
                             version_number: "#{changelog}"
                             )
end

lane :set_build_number do
    if UI.interactive?
        changelog = UI.input "Please enter the new build numbe: "
    end
    increment_version_number(
                             build_number: "#{changelog}"
                             )
end

lane :increase_build_number do
    updateProjectBuildNumber
end



# è¿™æ˜¯å®šä¹‰åœ¨ Fastlane æ–‡ä»¶ä¹‹å¤–çš„ä¸€æ®µè„šæœ¬ï¼Œç›®çš„æ˜¯è®¾ç½®å½“å‰çš„build ä¸ºæ—¥æœŸåŠ ç‰ˆæœ¬
def updateProjectBuildNumber
    currentTime = Time.new.strftime("%y%m%d")
    build = get_build_number()

    if build.include?"#{currentTime}"

        # => ä¸ºå½“å¤©ç‰ˆæœ¬ è®¡ç®—è¿­ä»£ç‰ˆæœ¬å·
        lastStr = build[build.length-1]
        lastNum = lastStr.to_i

        if lastNum == 9

            UI.error " ğŸš«  error =>  buildæœ«ä½å·²ç»æ˜¯ 9 "
            return
        end

        lastNum = lastNum +1
        build ="#{currentTime}#{lastNum}"

        else

        # => éå½“å¤©ç‰ˆæœ¬ build å·é‡ç½®
        build ="#{currentTime}0"
    end

    puts("*************| æ›´æ–°build #{build} |*************")

    # => æ›´æ”¹é¡¹ç›® build å·
    increment_build_number(
                           build_number:"#{build}"
                           )
end
```

- ç”¨æ¨¡æ‹Ÿå™¨æµ‹è¯•ã€æ‰“åŒ…ipa

```    
lane :tests do
    run_tests(scheme: "Project", devices: ["iPhone 8"])
end

lane :build do
    build_app(scheme: 'Project',
              output_directory: './build')
end
```

- è¿è¡Œ swiftlint

```    
    desc "run swiftlint"
    lane :lint do
        swiftlint( strict: true )
    end

```


æš‚æ—¶è¿™äº›åŠŸèƒ½å§...
